ALTER TABLE ACCOUNTS DROP FOREIGN KEY ACCOUNTS_ibfk_1;
ALTER TABLE CLUSTERS DROP FOREIGN KEY CLUSTERS_ibfk_1;
ALTER TABLE SUBSCRIBERS DROP FOREIGN KEY SUBSCRIBERS_ibfk_1;

ALTER TABLE ACCOUNTS CHANGE COLUMN id id VARCHAR(36);
ALTER TABLE ACCOUNTS CHANGE COLUMN offeringId offeringId VARCHAR(36);
ALTER TABLE CLUSTERS CHANGE COLUMN id id VARCHAR(36);
ALTER TABLE CLUSTERS CHANGE COLUMN owner owner VARCHAR(36);
ALTER TABLE CLUSTERS ADD COLUMN currentStep VARCHAR(30);
ALTER TABLE CONTROLTYPES CHANGE COLUMN id id VARCHAR(36);
ALTER TABLE DATACENTERS CHANGE COLUMN id id VARCHAR(36);
ALTER TABLE DATACENTERFIELDSMAP CHANGE COLUMN dataCenterId dataCenterId VARCHAR(36);
ALTER TABLE FORMFIELDS CHANGE COLUMN id id VARCHAR(36);
ALTER TABLE STEPDETAILS CHANGE COLUMN id id VARCHAR(36);
ALTER TABLE SUBSCRIBERS CHANGE COLUMN id id VARCHAR(36);
ALTER TABLE SUBSCRIBERS CHANGE COLUMN accountId accountId VARCHAR(36);
ALTER TABLE FORMFIELDS ADD COLUMN maximumValue int(10) DEFAULT 0;
ALTER TABLE FORMFIELDS ADD COLUMN minimumValue int(10) DEFAULT 0;

ALTER TABLE ACCOUNTS ADD CONSTRAINT `ACCOUNTS_ibfk_1` FOREIGN KEY (offeringId) REFERENCES OFFERINGS(id) ON DELETE RESTRICT;
ALTER TABLE SUBSCRIBERS ADD CONSTRAINT `SUBSCRIBERS_ibfk_1` FOREIGN KEY (accountId) REFERENCES ACCOUNTS(id) ON DELETE RESTRICT;
ALTER TABLE CLUSTERS ADD CONSTRAINT `CLUSTERS_ibfk_1` FOREIGN KEY (owner) REFERENCES SUBSCRIBERS(id) ON DELETE RESTRICT;

CREATE TABLE ACCOUNT_PARAMS (
  accountId VARCHAR(36) NOT NULL,
  name VARCHAR(250),
  value VARCHAR(4096),
  FOREIGN KEY (accountId) REFERENCES ACCOUNTS(id) ON DELETE CASCADE
) ENGINE=INNODB;

CREATE TABLE CLUSTER_PARAMS (
  clusterId VARCHAR(36) NOT NULL,
  name VARCHAR(250),
  value VARCHAR(4096),
  FOREIGN KEY (clusterId) REFERENCES CLUSTERS(id) ON DELETE CASCADE
) ENGINE=INNODB;

CREATE TABLE CPELOCATIONS (
  name VARCHAR(100) NOT NULL,
  url VARCHAR(200) NOT NULL,
  pcmaeBackendId VARCHAR(50) NOT NULL,
  PRIMARY KEY (name),
  FOREIGN KEY (pcmaeBackendId) REFERENCES PCMAEBACKENDS(id) ON DELETE RESTRICT
) ENGINE = InnoDB;

CREATE TABLE OFFERINGLOCATIONS (
  id VARCHAR(36) NOT NULL ,
  offeringId VARCHAR(50) NOT NULL ,
  cpeLocationName VARCHAR(100) NOT NULL,
  PRIMARY KEY (id) ,
  FOREIGN KEY (offeringId ) REFERENCES OFFERINGS (id ) ON DELETE RESTRICT,
  FOREIGN KEY (cpeLocationName ) REFERENCES CPELOCATIONS (name ) ON DELETE RESTRICT
) ENGINE = InnoDB;

CREATE TABLE SOFTLAYERACCOUNTS (
  id 			VARCHAR(36) NOT NULL,
  url			VARCHAR(50),
  username		VARCHAR(64),
  apiKey 		VARCHAR(128),
  PRIMARY KEY (id)
) ENGINE=INNODB;

CREATE TABLE GATEWAYS (
  id VARCHAR(36) NOT NULL,
  softLayerId	INT,
  username		VARCHAR(25),
  password		VARCHAR(50),
  subscriberId		VARCHAR(36),
  type			VARCHAR(10) NOT NULL,
  softLayerAccountId  VARCHAR(36) NOT NULL,	
  cpeLocationName VARCHAR(100) NOT NULL,
  PRIMARY KEY (id),
  FOREIGN KEY (subscriberId) REFERENCES SUBSCRIBERS(id) ON DELETE CASCADE,
  FOREIGN KEY (softLayerAccountId) REFERENCES SOFTLAYERACCOUNTS(id) ON DELETE RESTRICT,
  FOREIGN KEY (cpeLocationName ) REFERENCES CPELOCATIONS (name ) ON DELETE RESTRICT
) ENGINE=INNODB;

CREATE TABLE GATEWAY_SSL_CERTS (
  gatewayId    VARCHAR(36) NOT NULL,
  memberIp     VARCHAR(36) NOT NULL,
  sslCert      VARCHAR(1024) NOT NULL,
  FOREIGN KEY (gatewayId) REFERENCES GATEWAYS(id) ON DELETE CASCADE
) ENGINE=INNODB;

CREATE TABLE VLANS (
  id VARCHAR(36) NOT NULL,
  softLayerId	INT,
  clusterId	VARCHAR(36),
  gatewayId		VARCHAR(36),
  softLayerAccountId  VARCHAR(36),
  cpeLocationName VARCHAR(100) NOT NULL,
  PRIMARY KEY (id),
  FOREIGN KEY (gatewayId) REFERENCES GATEWAYS(id),
  FOREIGN KEY (clusterId) REFERENCES CLUSTERS(id),
  FOREIGN KEY (softLayerAccountId) REFERENCES SOFTLAYERACCOUNTS(id) ON DELETE RESTRICT,
  FOREIGN KEY (cpeLocationName ) REFERENCES CPELOCATIONS (name ) ON DELETE RESTRICT
) ENGINE=INNODB;

CREATE TABLE SUBNETS (
  id VARCHAR(36) NOT NULL,
  softLayerId	INT,
  vlanId		VARCHAR(36) NOT NULL,
  networkAddr	VARCHAR(15),
  gatewayAddr	VARCHAR(15),
  broadcastAddr	VARCHAR(15),
  cidr			INT,
  softLayerAccountId  VARCHAR(36),
  PRIMARY KEY (id),
  FOREIGN KEY (vlanId) REFERENCES VLANS(id) ON DELETE CASCADE,
  FOREIGN KEY (softLayerAccountId) REFERENCES SOFTLAYERACCOUNTS(id) ON DELETE RESTRICT
) ENGINE=INNODB;

CREATE TABLE IPADDRESS (
  id VARCHAR(36) NOT NULL,
  ipAddress 	BIGINT NOT NULL,
  subnetId		VARCHAR(36) NOT NULL,
  hostname		VARCHAR(64),
  clusterId		VARCHAR(36),
  tierName		VARCHAR(50),
  PRIMARY KEY (id),
  FOREIGN KEY (subnetId) REFERENCES SUBNETS(id) ON DELETE CASCADE,
  FOREIGN KEY (clusterId) REFERENCES CLUSTERS(id) ON DELETE CASCADE
) ENGINE=INNODB;

CREATE TABLE VPNTUNNELS (
	id     		VARCHAR(36) NOT NULL,
	custIpAddr	VARCHAR(36) NOT NULL,
	gatewayId	VARCHAR(36),
	clusterId	VARCHAR(36) NOT NULL,
	PRIMARY KEY (id),
	FOREIGN KEY (gatewayId) REFERENCES GATEWAYS(id) ON DELETE RESTRICT,
	FOREIGN KEY (clusterId) REFERENCES CLUSTERS(id) ON DELETE CASCADE
) ENGINE=INNODB;

CREATE TABLE VPNTUNNEL_PARAMS (
	vpnTunnelId	VARCHAR(36) NOT NULL,
	name		VARCHAR(50) NOT NULL,
	value		VARCHAR(255),
	FOREIGN KEY (vpnTunnelId) REFERENCES VPNTUNNELS(id) on DELETE CASCADE
) ENGINE=INNODB;

CREATE TABLE VPNTUNNEL_SUBNET (
	vpnTunnelId	VARCHAR(36) NOT NULL,
	subnetId	VARCHAR(36) NOT NULL,
	FOREIGN KEY (vpnTunnelId) REFERENCES VPNTUNNELS(id) on DELETE CASCADE,
	FOREIGN KEY (subnetId) REFERENCES SUBNETS(id) on DELETE CASCADE
) ENGINE=INNODB;

ALTER TABLE OFFERINGS DROP FOREIGN KEY OFFERINGS_ibfk_1;
ALTER TABLE OFFERINGS DROP COLUMN backendId;


